\hypertarget{classew_1_1Tps3}{
\subsection{ew::Tps3 Class Reference}
\label{classew_1_1Tps3}\index{ew::Tps3@{ew::Tps3}}
}


Thin-\/Plate Spline in 3D.  




{\ttfamily \#include $<$ew/Tps3.h$>$}

\subsubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static void \hyperlink{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{interaction} (double $\ast$L, const double $\ast$lmks, int n\_\-lmks)
\item 
static void \hyperlink{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}{algebraic\_\-size} (int $\ast$f\_\-size, bool $\ast$is\_\-mixed, bool $\ast$is\_\-reduced, const int $\ast$relax\_\-dims\_\-opt, int n\_\-lmks)
\item 
static void \hyperlink{classew_1_1Tps3_abc71d05432b69dcaab46b5a2e2dc5e2a}{factorize} (double $\ast$F, int $\ast$pivots, double $\ast$nonsingularity, const double $\ast$L, const int $\ast$relax\_\-dims\_\-opt, const double $\ast$relax\_\-params\_\-opt, int f\_\-size, bool is\_\-mixed, bool is\_\-reduced, int n\_\-lmks)
\item 
static void \hyperlink{classew_1_1Tps3_acf2ff420aa319fa03e4ae0efbdbb420a}{solve} (double $\ast$spline, double $\ast$energy\_\-opt, double $\ast$relax\_\-lmk\_\-images\_\-opt, const double $\ast$F, const int $\ast$pivots, const double $\ast$lmk\_\-images, const int $\ast$relax\_\-dims\_\-opt, const double $\ast$relax\_\-params\_\-opt, const double $\ast$L, int n\_\-lmks, int f\_\-size, bool is\_\-mixed, bool is\_\-reduced)
\item 
static void \hyperlink{classew_1_1Tps3_a0ccbf7e7cc36166e6d4c9e0353253cf3}{map} (double $\ast$point\_\-images, const double $\ast$points, int n\_\-points, const double $\ast$spline, const double $\ast$lmks, int n\_\-lmks)
\item 
static void \hyperlink{classew_1_1Tps3_ae7698c93f60039fa422e620658b254cf}{cache} (float $\ast$cache, const float $\ast$points, int n\_\-points, const double $\ast$lmk)
\item 
static void \hyperlink{classew_1_1Tps3_a0ba8dc750773d749e97459f565bb3fda}{cache\_\-map} (float $\ast$point\_\-images, const float $\ast$points, float $\ast$const ($\ast$caches), int n\_\-points, const double $\ast$spline, int n\_\-lmks)
\item 
static void \hyperlink{classew_1_1Tps3_a25e1d6b86c7ff8fe5a2a04151e636082}{bending\_\-energy} (double $\ast$B, const double $\ast$F, const int $\ast$pivots, const int $\ast$relax\_\-dims\_\-opt, const double $\ast$relax\_\-params\_\-opt, int n\_\-lmks, int f\_\-size, bool is\_\-mixed, bool is\_\-reduced)
\item 
static void \hyperlink{classew_1_1Tps3_a72705ad5c3eb18ad424598840dd4e2c2}{principal\_\-warps} (double $\ast$P, double $\ast$evals, const double $\ast$B, int n\_\-lmks, bool is\_\-mixed)
\item 
static void \hyperlink{classew_1_1Tps3_a02aeaf33e23f589c11ac000452a76775}{principal\_\-axes} (double $\ast$centroid, double $\ast$sum\_\-squares, double $\ast$axes, const double $\ast$lmks, int n\_\-lmks)
\item 
static void \hyperlink{classew_1_1Tps3_a7387ee3274c7c6ba83c499b809506863}{uniform\_\-basis} (double $\ast$basis, double $\ast$transforms\_\-opt, const double $\ast$centroid, const double $\ast$sum\_\-squares, const double $\ast$axes, const double $\ast$lmks, int n\_\-lmks)
\end{DoxyCompactItemize}


\subsubsection{Detailed Description}
\hyperlink{classew_1_1Tps3}{ew::Tps3} is a class of static methods. It implements the thin-\/plate spline in $\mathbb{R}^3$. It supports semi-\/landmarks that are allowed to slide along affine subspaces.

The method interfaces are purely procedural. It is up to the caller to provide the space for the arguments and for the results. The only memory management performed is for internal temporary scratch space.

The numerical linear algebra is performed by the LAPACK library. The thin-\/plate spline system of equations has a symmetric, semi-\/definite matrix of coefficients. It is factorizated using the LAPACK function {\ttfamily DSYTRF} and solve using the LAPACK function {\ttfamily DSYTRS}. {\ttfamily DSYTRF} uses the Bunch-\/Kaufman diagonal pivoting algorithm. In the calculation of bending energy, the matrix inversion is performed by {\ttfamily DSYTRI}. In the calculation of principal warps and principal axes, the eigenanalysis is preformed by {\ttfamily DSYEV}. Lapack includes an error handler, {\ttfamily xerbla}, which will get linked into the program. However, provided this class is used correctly, {\ttfamily xerbla} will never be called.

On Mac OS X (as of 2010-\/02), the bundled lapack implementation can crash if the array arguments are not 16 byte aligned. Consequently, the array arguments of \hyperlink{classew_1_1Tps3}{ew::Tps3} methods should be 16 byte aligned.

In this documentation, the first index of a matrix element is considered to be the row number, the second the column number. Matrix elements of all these methods are stored consecutively in memory by rows.

See \hyperlink{semilandmarks}{Thin-\/Plate Spline with Semi-\/landmarks on Affine Subspaces} and \hyperlink{uniform_warps}{Canonical Uniform Warp Basis} for details of the algorithms used by these methods. 

\subsubsection{Member Function Documentation}
\hypertarget{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{
\index{ew::Tps3@{ew::Tps3}!interaction@{interaction}}
\index{interaction@{interaction}!ew::Tps3@{ew::Tps3}}
\paragraph[{interaction}]{\setlength{\rightskip}{0pt plus 5cm}void ew::Tps3::interaction (
\begin{DoxyParamCaption}
\item[{double $\ast$}]{ L, }
\item[{const double $\ast$}]{ lmks, }
\item[{int}]{ n\_\-lmks}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}\hfill}
\label{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}
This calculates the thin-\/plate spline interaction matrix of a configuration of landmarks. 
\begin{DoxyParams}{Parameters}
\item[\mbox{\tt[out]} {\em L}]This is a matrix of size ({\itshape n\_\-lmks\/} + 4) x ({\itshape n\_\-lmks\/} + 4). The result is a symmetric and only the upper diagonal part is stored. \item[\mbox{\tt[in]} {\em lmks}]This is a matrix of size {\itshape n\_\-lmks\/} x 3 containing the landmark coordinates. \item[\mbox{\tt[in]} {\em n\_\-lmks}]This is the number of landmarks. \end{DoxyParams}
\hypertarget{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}{
\index{ew::Tps3@{ew::Tps3}!algebraic\_\-size@{algebraic\_\-size}}
\index{algebraic\_\-size@{algebraic\_\-size}!ew::Tps3@{ew::Tps3}}
\paragraph[{algebraic\_\-size}]{\setlength{\rightskip}{0pt plus 5cm}void ew::Tps3::algebraic\_\-size (
\begin{DoxyParamCaption}
\item[{int $\ast$}]{ f\_\-size, }
\item[{bool $\ast$}]{ is\_\-mixed, }
\item[{bool $\ast$}]{ is\_\-reduced, }
\item[{const int $\ast$}]{ relax\_\-dims\_\-opt, }
\item[{int}]{ n\_\-lmks}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}\hfill}
\label{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}
This calculates the algebraic dimension and other characteristics of a thin-\/plate spline configuration with semi-\/landmarks. It is not necessary to call this function if there are no semi-\/landmarks. 
\begin{DoxyParams}{Parameters}
\item[\mbox{\tt[out]} {\em f\_\-size}]This is the location to store the algebraic dimension of the thin-\/plate spline equation. {\itshape f\_\-size\/} is needed to allocate space for arguments to other functions. If {\itshape is\_\-mixed\/} is {\ttfamily false}, it is at most {\itshape n\_\-lmks\/} + 4. Otherwise it is less than 3 $\ast$ ({\itshape n\_\-lmks\/} + 4). If there are no semi-\/landmarks, it is exactly {\itshape n\_\-lmks\/} + 4. In general, the difference between these upper limits and {\itshape f\_\-size\/} is the sum of the elements of {\itshape relax\_\-dims\/}. \item[\mbox{\tt[out]} {\em is\_\-mixed}]This is the location to store a {\ttfamily boolean} value indicating whether the 3 dimensions are mixed in the thin-\/plate spline equation. If not, the thin-\/plate spline equation can be solved in each dimension separately. If there are no semi-\/landmarks, this will be {\ttfamily false}. It is {\ttfamily true} if there are semi-\/landmarks sliding in spaces of non-\/zero dimension and non-\/zero co-\/dimension. \item[\mbox{\tt[out]} {\em is\_\-reduced}]This is the location to store a {\ttfamily boolean} value indicating whether there are any non-\/trivial semi-\/landmarks, and consequently, whether the thin-\/plate spline equation has been reduced. If there are no semi-\/landmarks, this will be {\ttfamily false}. It is {\ttfamily true} if there are semi-\/landmarks sliding in spaces of non-\/zero dimension. \item[\mbox{\tt[in]} {\em relax\_\-dims\_\-opt}]This is an array of size {\itshape n\_\-lmks\/} containing the dimensions of the sliding spaces for each landmark. Each can be 0, 1, 2 or 3. For landmarks that are not semi-\/landmarks, the entries should be 0. If there are no semi-\/landmarks, this can be {\ttfamily NULL}. \item[\mbox{\tt[in]} {\em n\_\-lmks}]See \hyperlink{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{interaction}. \end{DoxyParams}
\hypertarget{classew_1_1Tps3_abc71d05432b69dcaab46b5a2e2dc5e2a}{
\index{ew::Tps3@{ew::Tps3}!factorize@{factorize}}
\index{factorize@{factorize}!ew::Tps3@{ew::Tps3}}
\paragraph[{factorize}]{\setlength{\rightskip}{0pt plus 5cm}void ew::Tps3::factorize (
\begin{DoxyParamCaption}
\item[{double $\ast$}]{ F, }
\item[{int $\ast$}]{ pivots, }
\item[{double $\ast$}]{ nonsingularity, }
\item[{const double $\ast$}]{ L, }
\item[{const int $\ast$}]{ relax\_\-dims\_\-opt, }
\item[{const double $\ast$}]{ relax\_\-params\_\-opt, }
\item[{int}]{ f\_\-size, }
\item[{bool}]{ is\_\-mixed, }
\item[{bool}]{ is\_\-reduced, }
\item[{int}]{ n\_\-lmks}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}\hfill}
\label{classew_1_1Tps3_abc71d05432b69dcaab46b5a2e2dc5e2a}
This calculates the algebraic equation corresponding to the semi-\/landmark constraints, and factorizes the coefficient matrix. If {\itshape is\_\-mixed\/} is {\ttfamily true}, this equation is mixed. Otherwise it separates into equations in each coordinate direction. It uses outputs from \hyperlink{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{interaction} and \hyperlink{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}{algebraic\_\-size}. 
\begin{DoxyParams}{Parameters}
\item[\mbox{\tt[out]} {\em F}]This is a matrix of size {\itshape f\_\-size\/} x {\itshape f\_\-size\/}. The factorization of the coefficient matrix is stored here. It is not output if the thin-\/plate spline is singular. \item[\mbox{\tt[out]} {\em pivots}]This is an array of size {\itshape f\_\-size\/}. The pivots used in the factorization are stored here. It is not output if the thin-\/plate spline is singular. \item[\mbox{\tt[out]} {\em nonsingularity}]This is the inverse of the condition number of the block diagonal matrix resulting from the matrix factorization. If this is exactly 0.0, the other outputs will not have been set and they must not used in \hyperlink{classew_1_1Tps3_acf2ff420aa319fa03e4ae0efbdbb420a}{solve}. If this is close to 0.0, the other outputs are unreliable and should also not be used. A spline is exactly singular when there are 2 landmarks with the same coordinates, or when the landmarks are coplanar. In this case, the {\itshape nonsingularity\/} might not be exactly 0.0 due to numerical error. Conversely, the spline equation might be numerically unsolvable without it being exactly singular, for example, if there are an excessive number of landmarks, if some landmarks are very close together, or if the landmarks are nearly coplanar. The lower limit for the {\itshape nonsingularity\/} should be high enough to catch these cases, but not so high as to reject too many usable splines. A limit of {\ttfamily 1.0e-\/8} is a sensible starting point. \item[\mbox{\tt[in]} {\em L}]See \hyperlink{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{interaction}. \item[\mbox{\tt[in]} {\em relax\_\-dims\_\-opt}]See \hyperlink{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}{algebraic\_\-size}. \item[\mbox{\tt[in]} {\em relax\_\-params\_\-opt}]This is a matrix of size {\itshape n\_\-lmks\/} x 3. For every semi-\/landmark sliding along a line, the corresponding row of this matrix should be a unit vector in the direction of the line. For every semi-\/landmark sliding along a plane, the corresponding row of this matrix should be a unit vector normal to the plane. The other rows need not be set. If there are no semi-\/landmarks of dimension 1 or 2, this can be {\ttfamily NULL}. \item[\mbox{\tt[in]} {\em f\_\-size}]See \hyperlink{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}{algebraic\_\-size}. \item[\mbox{\tt[in]} {\em is\_\-mixed}]See \hyperlink{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}{algebraic\_\-size}. \item[\mbox{\tt[in]} {\em is\_\-reduced}]See \hyperlink{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}{algebraic\_\-size}. \item[\mbox{\tt[in]} {\em n\_\-lmks}]See \hyperlink{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{interaction}. \end{DoxyParams}

\begin{DoxyExceptions}{Exceptions}
\item[{\em std::bad\_\-alloc}]\end{DoxyExceptions}
\hypertarget{classew_1_1Tps3_acf2ff420aa319fa03e4ae0efbdbb420a}{
\index{ew::Tps3@{ew::Tps3}!solve@{solve}}
\index{solve@{solve}!ew::Tps3@{ew::Tps3}}
\paragraph[{solve}]{\setlength{\rightskip}{0pt plus 5cm}void ew::Tps3::solve (
\begin{DoxyParamCaption}
\item[{double $\ast$}]{ spline, }
\item[{double $\ast$}]{ energy\_\-opt, }
\item[{double $\ast$}]{ relax\_\-lmk\_\-images\_\-opt, }
\item[{const double $\ast$}]{ F, }
\item[{const int $\ast$}]{ pivots, }
\item[{const double $\ast$}]{ lmk\_\-images, }
\item[{const int $\ast$}]{ relax\_\-dims\_\-opt, }
\item[{const double $\ast$}]{ relax\_\-params\_\-opt, }
\item[{const double $\ast$}]{ L, }
\item[{int}]{ n\_\-lmks, }
\item[{int}]{ f\_\-size, }
\item[{bool}]{ is\_\-mixed, }
\item[{bool}]{ is\_\-reduced}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}\hfill}
\label{classew_1_1Tps3_acf2ff420aa319fa03e4ae0efbdbb420a}
This calculates a thin-\/plate spline from a configuration of landmark images. It uses outputs from \hyperlink{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{interaction}, \hyperlink{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}{algebraic\_\-size} and \hyperlink{classew_1_1Tps3_abc71d05432b69dcaab46b5a2e2dc5e2a}{factorize}. It should not be called if the thin-\/plate spline is singular. 
\begin{DoxyParams}{Parameters}
\item[\mbox{\tt[out]} {\em spline}]This is a matrix of size ({\itshape n\_\-lmks\/} + 4) x 3. The coefficients of the solution thin-\/plate spline are stored here. \item[\mbox{\tt[out]} {\em energy\_\-opt}]This is the location to store the bending energy of the thin-\/plate spline. It can be {\ttfamily NULL}, in which case the energy is not calculated. \item[\mbox{\tt[out]} {\em relax\_\-lmk\_\-images\_\-opt}]This is a matrix of size {\itshape n\_\-lmks\/} x 3. It is the location to store the optimized landmark images. These are the landmark images that would minimize bending energy consistent with the semi-\/landmark constraints. It can be {\ttfamily NULL}, in which case they are not calculated. \item[\mbox{\tt[in]} {\em F}]See \hyperlink{classew_1_1Tps3_abc71d05432b69dcaab46b5a2e2dc5e2a}{factorize}. \item[\mbox{\tt[in]} {\em pivots}]See \hyperlink{classew_1_1Tps3_abc71d05432b69dcaab46b5a2e2dc5e2a}{factorize}. \item[\mbox{\tt[in]} {\em lmk\_\-images}]This is a matrix of size {\itshape n\_\-lmks\/} x 3 containing the landmark image coordinates. \item[\mbox{\tt[in]} {\em relax\_\-dims\_\-opt}]See \hyperlink{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}{algebraic\_\-size}. \item[\mbox{\tt[in]} {\em relax\_\-params\_\-opt}]See \hyperlink{classew_1_1Tps3_abc71d05432b69dcaab46b5a2e2dc5e2a}{factorize}. \item[\mbox{\tt[in]} {\em L}]See \hyperlink{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{interaction}. \item[\mbox{\tt[in]} {\em n\_\-lmks}]See \hyperlink{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{interaction}. \item[\mbox{\tt[in]} {\em f\_\-size}]See \hyperlink{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}{algebraic\_\-size}. \item[\mbox{\tt[in]} {\em is\_\-mixed}]See \hyperlink{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}{algebraic\_\-size}. \item[\mbox{\tt[in]} {\em is\_\-reduced}]See \hyperlink{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}{algebraic\_\-size}. \end{DoxyParams}

\begin{DoxyExceptions}{Exceptions}
\item[{\em std::bad\_\-alloc}]\end{DoxyExceptions}
\hypertarget{classew_1_1Tps3_a0ccbf7e7cc36166e6d4c9e0353253cf3}{
\index{ew::Tps3@{ew::Tps3}!map@{map}}
\index{map@{map}!ew::Tps3@{ew::Tps3}}
\paragraph[{map}]{\setlength{\rightskip}{0pt plus 5cm}void ew::Tps3::map (
\begin{DoxyParamCaption}
\item[{double $\ast$}]{ point\_\-images, }
\item[{const double $\ast$}]{ points, }
\item[{int}]{ n\_\-points, }
\item[{const double $\ast$}]{ spline, }
\item[{const double $\ast$}]{ lmks, }
\item[{int}]{ n\_\-lmks}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}\hfill}
\label{classew_1_1Tps3_a0ccbf7e7cc36166e6d4c9e0353253cf3}
This calculates the images of a list of points under a thin-\/plate spline. It uses outputs of \hyperlink{classew_1_1Tps3_acf2ff420aa319fa03e4ae0efbdbb420a}{solve}. It should not be called if the thin-\/plate spline is singular. 
\begin{DoxyParams}{Parameters}
\item[\mbox{\tt[in]} {\em point\_\-images}]This is a matrix of size {\itshape n\_\-points\/} x 3. It is the location to store the coordinates of the images of the points. \item[\mbox{\tt[in]} {\em points}]This is a matrix of size {\itshape n\_\-points\/} x 3, containing the coordinates of the points \item[\mbox{\tt[in]} {\em n\_\-points}]This is the number of points. \item[\mbox{\tt[in]} {\em spline}]See \hyperlink{classew_1_1Tps3_acf2ff420aa319fa03e4ae0efbdbb420a}{solve}. \item[\mbox{\tt[in]} {\em lmks}]See \hyperlink{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{interaction}. \item[\mbox{\tt[in]} {\em n\_\-lmks}]See \hyperlink{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{interaction}. \end{DoxyParams}
\hypertarget{classew_1_1Tps3_ae7698c93f60039fa422e620658b254cf}{
\index{ew::Tps3@{ew::Tps3}!cache@{cache}}
\index{cache@{cache}!ew::Tps3@{ew::Tps3}}
\paragraph[{cache}]{\setlength{\rightskip}{0pt plus 5cm}void ew::Tps3::cache (
\begin{DoxyParamCaption}
\item[{float $\ast$}]{ cache, }
\item[{const float $\ast$}]{ points, }
\item[{int}]{ n\_\-points, }
\item[{const double $\ast$}]{ lmk}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}\hfill}
\label{classew_1_1Tps3_ae7698c93f60039fa422e620658b254cf}
This evaluates a single thin-\/plate spline kernel function at a list of points. It is intended for speed critical situations where incremental changes are made to a thin-\/plate spline that is being applied to a fixed set of points. It requires a {\itshape cache\/} for each landmark, which could be a require a significant amount of memory. The {\itshape points\/} and {\itshape cache\/} are of type {\ttfamily float} rather than {\ttfamily double} to save space. As a consequence, the accuracy of the mapped points is reduced. 
\begin{DoxyParams}{Parameters}
\item[\mbox{\tt[out]} {\em cache}]This is an array of size n\_\-points. The cached evaluations are stored here. \item[\mbox{\tt[in]} {\em points}]See \hyperlink{classew_1_1Tps3_a0ccbf7e7cc36166e6d4c9e0353253cf3}{map}, except that this is a {\ttfamily float} array rather than {\ttfamily double}. \item[\mbox{\tt[in]} {\em n\_\-points}]See \hyperlink{classew_1_1Tps3_a0ccbf7e7cc36166e6d4c9e0353253cf3}{map}. \item[\mbox{\tt[in]} {\em lmk}]This points to an array of size 3 containing the coordinates of the landmark. \end{DoxyParams}
\hypertarget{classew_1_1Tps3_a0ba8dc750773d749e97459f565bb3fda}{
\index{ew::Tps3@{ew::Tps3}!cache\_\-map@{cache\_\-map}}
\index{cache\_\-map@{cache\_\-map}!ew::Tps3@{ew::Tps3}}
\paragraph[{cache\_\-map}]{\setlength{\rightskip}{0pt plus 5cm}void ew::Tps3::cache\_\-map (
\begin{DoxyParamCaption}
\item[{float $\ast$}]{ point\_\-images, }
\item[{const float $\ast$}]{ points, }
\item[{float $\ast$const $\ast$}]{ caches, }
\item[{int}]{ n\_\-points, }
\item[{const double $\ast$}]{ spline, }
\item[{int}]{ n\_\-lmks}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}\hfill}
\label{classew_1_1Tps3_a0ba8dc750773d749e97459f565bb3fda}
This uses previously calculated cached kernel evaluations to calculate the images of a list of points under a thin-\/plate spline. It uses outputs from \hyperlink{classew_1_1Tps3_acf2ff420aa319fa03e4ae0efbdbb420a}{solve} and \hyperlink{classew_1_1Tps3_ae7698c93f60039fa422e620658b254cf}{cache}. It should not be called if the thin-\/plate spline is singular. 
\begin{DoxyParams}{Parameters}
\item[\mbox{\tt[in]} {\em point\_\-images}]See \hyperlink{classew_1_1Tps3_a0ccbf7e7cc36166e6d4c9e0353253cf3}{map}. \item[\mbox{\tt[in]} {\em points}]See \hyperlink{classew_1_1Tps3_a0ccbf7e7cc36166e6d4c9e0353253cf3}{map}. \item[\mbox{\tt[in]} {\em caches}]This is an array of size {\itshape n\_\-lmks\/}. It is an array of pointers, each pointing to the corresponding cache. \item[\mbox{\tt[in]} {\em n\_\-points}]See \hyperlink{classew_1_1Tps3_a0ccbf7e7cc36166e6d4c9e0353253cf3}{map}. \item[\mbox{\tt[in]} {\em spline}]See \hyperlink{classew_1_1Tps3_acf2ff420aa319fa03e4ae0efbdbb420a}{solve}. \item[\mbox{\tt[in]} {\em n\_\-lmks}]See \hyperlink{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{interaction}. \end{DoxyParams}
\hypertarget{classew_1_1Tps3_a25e1d6b86c7ff8fe5a2a04151e636082}{
\index{ew::Tps3@{ew::Tps3}!bending\_\-energy@{bending\_\-energy}}
\index{bending\_\-energy@{bending\_\-energy}!ew::Tps3@{ew::Tps3}}
\paragraph[{bending\_\-energy}]{\setlength{\rightskip}{0pt plus 5cm}void ew::Tps3::bending\_\-energy (
\begin{DoxyParamCaption}
\item[{double $\ast$}]{ B, }
\item[{const double $\ast$}]{ F, }
\item[{const int $\ast$}]{ pivots, }
\item[{const int $\ast$}]{ relax\_\-dims\_\-opt, }
\item[{const double $\ast$}]{ relax\_\-params\_\-opt, }
\item[{int}]{ n\_\-lmks, }
\item[{int}]{ f\_\-size, }
\item[{bool}]{ is\_\-mixed, }
\item[{bool}]{ is\_\-reduced}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}\hfill}
\label{classew_1_1Tps3_a25e1d6b86c7ff8fe5a2a04151e636082}
This calculates the bending energy matrix. If {\itshape is\_\-mixed\/}, it is a quadratic form on the mixed coordinates. Otherwise, it is a quadratic form that is applied separately to the x coordinates and to the y coordinates. If there are any non-\/trivial semi-\/landmarks, this is the form for the minimized bending energy. It uses outputs from \hyperlink{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{interaction}, \hyperlink{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}{algebraic\_\-size} and \hyperlink{classew_1_1Tps3_abc71d05432b69dcaab46b5a2e2dc5e2a}{factorize}. It should not be called if the thin-\/plate spline is singular. 
\begin{DoxyParams}{Parameters}
\item[\mbox{\tt[out]} {\em B}]This is the bending energy matrix. It is a symmetric matrix, with both upper and lower diagonal entries stored. If {\itshape is\_\-mixed\/}, it has size (3 $\ast$ {\itshape n\_\-lmks\/}) x (3 $\ast$ {\itshape n\_\-lmks\/}). Otherwise, it has size {\itshape n\_\-lmks\/} x {\itshape n\_\-lmks\/}. \item[\mbox{\tt[in]} {\em F}]See \hyperlink{classew_1_1Tps3_abc71d05432b69dcaab46b5a2e2dc5e2a}{factorize}. \item[\mbox{\tt[in]} {\em pivots}]See \hyperlink{classew_1_1Tps3_abc71d05432b69dcaab46b5a2e2dc5e2a}{factorize}. \item[\mbox{\tt[in]} {\em relax\_\-dims\_\-opt}]See \hyperlink{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}{algebraic\_\-size}. \item[\mbox{\tt[in]} {\em relax\_\-params\_\-opt}]See \hyperlink{classew_1_1Tps3_abc71d05432b69dcaab46b5a2e2dc5e2a}{factorize}. \item[\mbox{\tt[in]} {\em n\_\-lmks}]See \hyperlink{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{interaction}. \item[\mbox{\tt[in]} {\em f\_\-size}]See \hyperlink{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}{algebraic\_\-size}. \item[\mbox{\tt[in]} {\em is\_\-mixed}]See \hyperlink{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}{algebraic\_\-size}. \item[\mbox{\tt[in]} {\em is\_\-reduced}]See \hyperlink{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}{algebraic\_\-size}. \end{DoxyParams}

\begin{DoxyExceptions}{Exceptions}
\item[{\em std::bad\_\-alloc}]\end{DoxyExceptions}
\hypertarget{classew_1_1Tps3_a72705ad5c3eb18ad424598840dd4e2c2}{
\index{ew::Tps3@{ew::Tps3}!principal\_\-warps@{principal\_\-warps}}
\index{principal\_\-warps@{principal\_\-warps}!ew::Tps3@{ew::Tps3}}
\paragraph[{principal\_\-warps}]{\setlength{\rightskip}{0pt plus 5cm}void ew::Tps3::principal\_\-warps (
\begin{DoxyParamCaption}
\item[{double $\ast$}]{ P, }
\item[{double $\ast$}]{ evals, }
\item[{const double $\ast$}]{ B, }
\item[{int}]{ n\_\-lmks, }
\item[{bool}]{ is\_\-mixed}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}\hfill}
\label{classew_1_1Tps3_a72705ad5c3eb18ad424598840dd4e2c2}
This calculates the principal warps. If {\itshape is\_\-mixed\/}, they are a basis of the full space of landmark displacements. Otherwise, they are a basis of the space of landmarks in a single coordinate directions, either x or y. It uses outputs from \hyperlink{classew_1_1Tps3_a25e1d6b86c7ff8fe5a2a04151e636082}{bending\_\-energy}. It should not be called if the thin-\/plate spline is singular. 
\begin{DoxyParams}{Parameters}
\item[\mbox{\tt[out]} {\em P}]If {\itshape is\_\-mixed\/} is {\ttfamily false}, this is a matrix of size {\itshape n\_\-lmks\/} x {\itshape n\_\-lmks\/}. Otherwise it is a matrix of size (3 $\ast$ {\itshape n\_\-lmks\/}) x (3 $\ast$ {\itshape n\_\-lmks\/}). The eigenvectors are stored here. The form an orthogonal matrix. \item[\mbox{\tt[out]} {\em evals}]If {\itshape is\_\-mixed\/} is {\ttfamily false}, this is an array of size {\itshape n\_\-lmks\/}. Otherwise it is an array of size 3 $\ast$ {\itshape n\_\-lmks\/}. The eigenvalues are stored here. The eigenvectors are ordered so that the eigenvalues are in non-\/decreasing order. \item[\mbox{\tt[in]} {\em B}]See \hyperlink{classew_1_1Tps3_a25e1d6b86c7ff8fe5a2a04151e636082}{bending\_\-energy}. \item[\mbox{\tt[in]} {\em n\_\-lmks}]See \hyperlink{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{interaction}. \item[\mbox{\tt[in]} {\em is\_\-mixed}]See \hyperlink{classew_1_1Tps3_a11e70148259244e2c975dabd72ceb28c}{algebraic\_\-size}. \end{DoxyParams}

\begin{DoxyExceptions}{Exceptions}
\item[{\em std::runtime\_\-error}]The eigenanalysis failed to converge. \item[{\em std::bad\_\-alloc}]\end{DoxyExceptions}
\hypertarget{classew_1_1Tps3_a02aeaf33e23f589c11ac000452a76775}{
\index{ew::Tps3@{ew::Tps3}!principal\_\-axes@{principal\_\-axes}}
\index{principal\_\-axes@{principal\_\-axes}!ew::Tps3@{ew::Tps3}}
\paragraph[{principal\_\-axes}]{\setlength{\rightskip}{0pt plus 5cm}void ew::Tps3::principal\_\-axes (
\begin{DoxyParamCaption}
\item[{double $\ast$}]{ centroid, }
\item[{double $\ast$}]{ sum\_\-squares, }
\item[{double $\ast$}]{ axes, }
\item[{const double $\ast$}]{ lmks, }
\item[{int}]{ n\_\-lmks}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}\hfill}
\label{classew_1_1Tps3_a02aeaf33e23f589c11ac000452a76775}
This calculates a set of principal axes for the landmark configuration. The axes are not canonical, which is why their calculation and their use in \hyperlink{classew_1_1Tps3_a7387ee3274c7c6ba83c499b809506863}{uniform\_\-basis} are separated into different functions. They are canonical up to sign if the sum\_\-squares are different. It should not be called with an empty configuration of landmarks. 
\begin{DoxyParams}{Parameters}
\item[\mbox{\tt[out]} {\em centroid}]This points to an array of size 3 to store the centroid of the configuration. \item[\mbox{\tt[out]} {\em sum\_\-squares}]This points to an array of size 3 to store the sum of squared coordinates in the principal axes. \item[\mbox{\tt[out]} {\em axes}]This is a matrix of size {\itshape n\_\-lmks\/} x {\itshape n\_\-lmks\/}. It is the location to store the principal axes. They form an orthogonal matrix. \item[\mbox{\tt[in]} {\em lmks}]See \hyperlink{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{interaction}. \item[\mbox{\tt[in]} {\em n\_\-lmks}]See \hyperlink{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{interaction}. \end{DoxyParams}

\begin{DoxyExceptions}{Exceptions}
\item[{\em std::runtime\_\-error}]The eigenanalysis failed to converge. \item[{\em std::bad\_\-alloc}]\end{DoxyExceptions}
\hypertarget{classew_1_1Tps3_a7387ee3274c7c6ba83c499b809506863}{
\index{ew::Tps3@{ew::Tps3}!uniform\_\-basis@{uniform\_\-basis}}
\index{uniform\_\-basis@{uniform\_\-basis}!ew::Tps3@{ew::Tps3}}
\paragraph[{uniform\_\-basis}]{\setlength{\rightskip}{0pt plus 5cm}void ew::Tps3::uniform\_\-basis (
\begin{DoxyParamCaption}
\item[{double $\ast$}]{ basis, }
\item[{double $\ast$}]{ transforms\_\-opt, }
\item[{const double $\ast$}]{ centroid, }
\item[{const double $\ast$}]{ sum\_\-squares, }
\item[{const double $\ast$}]{ axes, }
\item[{const double $\ast$}]{ lmks, }
\item[{int}]{ n\_\-lmks}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}\hfill}
\label{classew_1_1Tps3_a7387ee3274c7c6ba83c499b809506863}
This calculates a canonical basis of the uniform subspace of the space of shape variations, given a set of principal axes for the configuration. The result is relative to the original axes, not the principal axes. If the configuration is degenerate (contained within a plane), this should not be called. 
\begin{DoxyParams}{Parameters}
\item[\mbox{\tt[out]} {\em basis}]This is a matrix of size 5 x {\itshape n\_\-lmks\/} x 3. The shape variables of the 5 basis elements are stored here. The first index is the number of the basis element. \item[\mbox{\tt[out]} {\em transforms\_\-opt}]This points to an array of size 5 $\ast$ 3 $\ast$ 3. Uniform shape variations are linear maps, so can be represented as 3 x 3 matrices. The matrices of the 5 basis elements are stored here. The first index is the number of the basis element. This can be {\ttfamily NULL}, in which case the transformations are not calculated. \item[\mbox{\tt[in]} {\em centroid}]See \hyperlink{classew_1_1Tps3_a02aeaf33e23f589c11ac000452a76775}{principal\_\-axes}. \item[\mbox{\tt[in]} {\em sum\_\-squares}]See \hyperlink{classew_1_1Tps3_a02aeaf33e23f589c11ac000452a76775}{principal\_\-axes}. \item[\mbox{\tt[in]} {\em axes}]See \hyperlink{classew_1_1Tps3_a02aeaf33e23f589c11ac000452a76775}{principal\_\-axes}. \item[\mbox{\tt[in]} {\em lmks}]See \hyperlink{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{interaction}. \item[\mbox{\tt[in]} {\em n\_\-lmks}]See \hyperlink{classew_1_1Tps3_add5597fd0edb1437c9694d765c507aff}{interaction}. \end{DoxyParams}
